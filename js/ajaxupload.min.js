// 1.0.1
$(function(){function e(e){return"number"!=typeof e?"":e>=1073741824?(e/1073741824).toFixed(2)+" GB":e>=1048576?(e/1048576).toFixed(2)+" MB":(e/1024).toFixed(2)+" KB"}var t=$("#upload ul");$("#drop a").click(function(){$(this).parent().find("input").click()}),$("#upload").fileupload({dropZone:$("#drop"),add:function(n,i){i.maxbytes=parseInt($("#drop").attr("data-max-bytes")),i.filetypes=$("#drop").attr("data-file-types").split(","),i.ext=i.files[0].name.split(".").pop();var a=$('<li class="working"><input type="text" value="0" data-width="48" data-height="48" data-fgColor="#0788a5" data-readOnly="1" data-bgColor="#3e4043" /><p></p><span></span></li>'),o=!0;if(a.find("p").text(i.files[0].name).append("<i>"+e(i.files[0].size)+'</i><br style="clear:both" />'(i.files[0].size>i.maxbytes||-1===jQuery.inArray(i.ext,i.filetypes)?"ERROR:":"")+(-1===jQuery.inArray(i.ext,i.filetypes)?" File must be "+(i.filetypes.length>1?"one of ":"of type ")+i.filetypes.join(", ")+" &nbsp; ":"")+(i.files[0].size>i.maxbytes?" Max size is "+e(i.maxbytes):"")),i.context=a.appendTo(t),a.find("input").knob(),a.find("span").click(function(){a.fadeOut(function(){a.remove()})}),i.files[0].size>i.maxbytes&&(o=!1),-1===jQuery.inArray(i.ext,i.filetypes)&&(o=!1),o){i.submit().success(function(e,t,n){var a=JSON.parse(e),o=a.status;"error"==o&&(i.context.find("p").append("<i>"+a.message+"</i>"),i.context.addClass("error"))})}},progress:function(e,t){var n=parseInt(t.loaded/t.total*100,10);t.context.find("input").val(n).change(),100==n&&(t.context.removeClass("working"),window.setTimeout(function(){window.opener&&window.opener.geid("form")&&(t.context.fadeOut("slow"),window.opener.geid("form").submit()),geid("form").submit()},1e3))},fail:function(e,t){t.context.addClass("error"),t.context.removeClass("working"),t.context.find("input").val(0).change(),alert(JSON.parse(t.jqXHR.responseText).message)}}),$(document).on("drop dragover",function(e){e.preventDefault()})});